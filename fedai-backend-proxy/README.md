# Fedai Backend Proxy

This Node.js Express server acts as a backend proxy for the Fedai Plant Health AI frontend application. Its primary purpose is to securely handle API requests to the Google Gemini API, keeping the API key confidential.

## Prerequisites

Before you begin, ensure you have the following installed on your system:

*   **Node.js:** Version 18.x or later is recommended. Node.js includes `npm` (Node Package Manager).
    *   **Download Node.js:** [https://nodejs.org/](https://nodejs.org/)
    *   **Verification:** Open your terminal (Command Prompt/PowerShell on Windows, Terminal on macOS/Linux) and type:
        ```bash
        node -v
        npm -v
        ```
        You should see the installed versions.

## Setup Instructions

These instructions are generally applicable to Linux (Fedora, Ubuntu, etc.), Windows, and macOS.

1.  **Create Project Directory:**
    *   If you haven't already, create a directory for this backend proxy server. This directory should be **separate** from the Fedai frontend application directory.
        ```bash
        mkdir fedai-backend-proxy
        cd fedai-backend-proxy
        ```

2.  **Create `package.json`:**
    Create a file named `package.json` in the `fedai-backend-proxy` directory with the following content:

    ```json
    {
      "name": "fedai-backend-proxy",
      "version": "1.0.0",
      "description": "Backend proxy for Fedai to securely call Google Gemini API",
      "main": "server.js",
      "scripts": {
        "start": "node server.js"
      },
      "dependencies": {
        "@google/genai": "^1.3.0",
        "cors": "^2.8.5",
        "dotenv": "^16.3.1",
        "express": "^4.18.2"
      }
    }
    ```

3.  **Install Dependencies:**
    In your terminal, within the `fedai-backend-proxy` directory, run:
    ```bash
    npm install
    ```
    This will download and install the packages listed in `package.json` into a `node_modules` folder.

4.  **Create `.env` File for API Key:**
    *   Create a file named `.env` in the `fedai-backend-proxy` root directory.
    *   Add your Google Gemini API key and desired port to this file:
        ```env
        GEMINI_API_KEY=YOUR_ACTUAL_GEMINI_API_KEY_HERE
        PORT=3001
        ```
    *   Replace `YOUR_ACTUAL_GEMINI_API_KEY_HERE` with your real API key obtained from [Google AI Studio](https://aistudio.google.com/app/apikey).
    *   The `PORT` variable specifies the port on which the proxy server will run. `3001` is a common choice for a secondary development server.

5.  **Create `.gitignore` File (Recommended):**
    To prevent accidentally committing your `.env` file (which contains your secret API key) and the `node_modules` folder to version control (like Git), create a file named `.gitignore` in the `fedai-backend-proxy` root directory with the following content:
    ```
    node_modules
    .env
    ```

6.  **Create `server.js`:**
    Create a file named `server.js` in the `fedai-backend-proxy` root directory. Copy the server code provided in the main Fedai project documentation (or from the `backend-proxy/server.js` file if it was generated by the assistant) into this file.
    *(The content of `server.js` is typically provided alongside these instructions or in the project's file structure.)*

## Running the Backend Proxy

1.  **Open your Terminal:**
    *   **Linux/macOS:** Open your standard Terminal application.
    *   **Windows:** Open Command Prompt or PowerShell.

2.  **Navigate to the Proxy Directory:**
    Use the `cd` command to navigate into the `fedai-backend-proxy` directory you created.
    ```bash
    cd path/to/your/fedai-backend-proxy
    ```

3.  **Start the Server:**
    Run the following command:
    ```bash
    npm start
    ```

4.  **Verify:**
    You should see output similar to this in your terminal:
    ```
    Fedai Backend Proxy listening on port 3001
    Frontend should call this proxy at http://localhost:3001/api/gemini-proxy (or relative /api/gemini-proxy if served together)
    ```
    This means your backend proxy server is running. Keep this terminal window open while you are using the Fedai frontend application.

## OS-Specific Notes

*   **Node.js Installation:**
    *   **Linux:** You can use Node Version Manager (`nvm`) or your distribution's package manager (e.g., `sudo apt install nodejs npm` on Debian/Ubuntu, `sudo dnf install nodejs` on Fedora). Using `nvm` is often preferred for managing multiple Node.js versions.
    *   **Windows/macOS:** Download the official installer from [nodejs.org](https://nodejs.org/).

*   **Firewall:**
    If you have a firewall enabled, ensure that it allows incoming connections on the port your proxy server is using (e.g., 3001). For local development, this is usually not an issue.

*   **Terminal Commands:**
    The `npm` commands (`npm install`, `npm start`) and `node` command are cross-platform and should work the same way in Command Prompt, PowerShell, or any Linux/macOS terminal once Node.js is correctly installed and in your system's PATH.

## CORS Configuration

The `server.js` file includes CORS (Cross-Origin Resource Sharing) configuration. By default, it's set up to allow requests from common frontend development server origins:
```javascript
const corsOptions = {
  origin: ['http://localhost:3000', 'http://localhost:8000', 'http://127.0.0.1:3000', 'http://127.0.0.1:8000'],
  optionsSuccessStatus: 200
};
```
If your Fedai frontend application is served from a different port during development (e.g., `http://localhost:5000`), you will need to add that origin to the `origin` array in `fedai-backend-proxy/server.js` and restart the proxy server.

For production, you would configure the `origin` to match your deployed frontend application's domain.

## Stopping the Server
To stop the proxy server, go to the terminal window where it's running and press `Ctrl+C`.